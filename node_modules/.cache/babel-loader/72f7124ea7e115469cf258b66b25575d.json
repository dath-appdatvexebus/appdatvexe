{"ast":null,"code":"import _classCallCheck from\"C:\\\\xampp\\\\htdocs\\\\vexedientu\\\\Front-End\\\\dath-react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\xampp\\\\htdocs\\\\vexedientu\\\\Front-End\\\\dath-react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _inherits from\"C:\\\\xampp\\\\htdocs\\\\vexedientu\\\\Front-End\\\\dath-react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"C:\\\\xampp\\\\htdocs\\\\vexedientu\\\\Front-End\\\\dath-react\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import React,{Component}from\"react\";import{PayPalButton}from\"react-paypal-button-v2\";import Axios from\"axios\";import retesData from\"../data/ratesData.json\";import swal from\"sweetalert\";import{Redirect}from\"react-router-dom\";var ThanhToan=/*#__PURE__*/function(_Component){_inherits(ThanhToan,_Component);var _super=_createSuper(ThanhToan);function ThanhToan(props){var _this;_classCallCheck(this,ThanhToan);_this=_super.call(this,props);_this.state={isGoNext:false};return _this;}_createClass(ThanhToan,[{key:\"postDatVe\",value:function postDatVe(){var _this2=this;// dữ liệu đẩy xuống backend xử lý\nvar postData=this.state;var axiosConfig={headers:{\"Content-Type\":\"application/json;charset=UTF-8\",\"Access-Control-Allow-Origin\":\"*\"}};Axios.post(\"/api/bookticket\",postData,axiosConfig).then(function(res){console.log(\"RESPONSE RECEIVED: \",res);swal({title:\"Tuyệt vời!\",text:\"Vé của bạn đã được đặt thành công!\",icon:\"success\"}).then(function(){_this2.setState({isGoNext:true});});}).catch(function(err){console.log(\"AXIOS ERROR: \",err);});}},{key:\"UNSAFE_componentWillMount\",// dữ liệu bước điền thông tin khách hàng\nvalue:function UNSAFE_componentWillMount(){var _this3=this;if(typeof Storage!==\"undefined\"){// get sessionStorage\nthis.step1=JSON.parse(sessionStorage.getItem(\"chonTuyen\"));this.step2=JSON.parse(sessionStorage.getItem(\"chonghe\"));this.step3=JSON.parse(sessionStorage.getItem(\"thongtinkhachhang\"));// chuyển tiền Việt nam qua tiền đô la để thanh toán paypal\n//console.log(this.doiTien(this.step2.tongtien, \"USD\", false));\n//console.log(typeof this.doiTien(this.step2.tongtien, \"USD\", false));\nthis.setState({tuyen:this.step1.inputTuyen,ngaydi:this.step1.ngayDi,// ép mảng ghế về chuỗi cho phù hợp với cơ sở dữ liệu\nghedat:this.step2.seatReserved.toString(),// các ghế đã đặt ở dạng mảng để có thể in ra giao diện\nghe:this.step2.seatReserved,tongtien:this.step2.tongtien,hoten:this.step3.inputHoTen,sdt:this.step3.inputPhone,email:this.step3.inputEmail,diachi:this.step3.inputAddress,idxe:this.step2.idXe,idlichchay:this.step2.idLichChay,idtuyen:this.step1.idTuyen,tongtienUSD:this.doiTien(this.step2.tongtien,\"USD\",false)},function(){return console.log(_this3.state);});}else{alert(\"Vui lòng quay lại trang chủ\");}}// ham chuyen đổi tỷ giá ngoại tệ\n},{key:\"doiTien\",value:function doiTien(money,code){var encode=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var input=parseFloat(money);if(Number.isNaN(input)){return\"\";}var currency=retesData.rates[0].value.find(function(item){return item.code===code;});if(!currency){return\"\";}var sell=parseFloat(currency.sell.replace(\",\",\"\"));var output=encode?input*sell:input/sell;var rounded=(Math.round(output*1000)/1000).toFixed(2);return rounded.toString();}},{key:\"render\",value:function render(){var _this4=this;var ngaydi=this.state.ngaydi;var tempdate=\"\";var inngaydi=tempdate.concat(ngaydi.substr(8,2),\" \",ngaydi.substr(4,1),\" \",ngaydi.substr(5,2),\" \",ngaydi.substr(4,1),\" \",ngaydi.substr(0,4));var pay=this.state.tongtienUSD;if(this.state.isGoNext===true){return/*#__PURE__*/React.createElement(Redirect,{to:\"/\"});}return/*#__PURE__*/React.createElement(\"section\",{className:\"payment\",style:{marginTop:\"100px\"}},/*#__PURE__*/React.createElement(\"div\",{className:\"md-stepper-horizontal\"},/*#__PURE__*/React.createElement(\"div\",{className:\"md-step active\"},/*#__PURE__*/React.createElement(\"div\",{className:\"md-step-circle\"},/*#__PURE__*/React.createElement(\"span\",{className:\"material-icons\"},\"directions_bus\")),/*#__PURE__*/React.createElement(\"div\",{className:\"md-step-title\"},\"Ch\\u1ECDn tuy\\u1EBFn\"),/*#__PURE__*/React.createElement(\"div\",{className:\"md-step-bar-left\"}),/*#__PURE__*/React.createElement(\"div\",{className:\"md-step-bar-right\"})),/*#__PURE__*/React.createElement(\"div\",{className:\"md-step active\"},/*#__PURE__*/React.createElement(\"div\",{className:\"md-step-circle\"},/*#__PURE__*/React.createElement(\"span\",{className:\"material-icons\"},\"event_seat\")),/*#__PURE__*/React.createElement(\"div\",{className:\"md-step-title\"},\"Ch\\u1ECDn gh\\u1EBF\"),/*#__PURE__*/React.createElement(\"div\",{className:\"md-step-bar-left\"}),/*#__PURE__*/React.createElement(\"div\",{className:\"md-step-bar-right\"})),/*#__PURE__*/React.createElement(\"div\",{className:\"md-step active\"},/*#__PURE__*/React.createElement(\"div\",{className:\"md-step-circle\"},/*#__PURE__*/React.createElement(\"span\",{className:\"material-icons\"},\"edit\")),/*#__PURE__*/React.createElement(\"div\",{className:\"md-step-title\"},\"\\u0110i\\u1EC1n th\\xF4ng tin\"),/*#__PURE__*/React.createElement(\"div\",{className:\"md-step-bar-left\"}),/*#__PURE__*/React.createElement(\"div\",{className:\"md-step-bar-right\"})),/*#__PURE__*/React.createElement(\"div\",{className:\"md-step active\"},/*#__PURE__*/React.createElement(\"div\",{className:\"md-step-circle\"},/*#__PURE__*/React.createElement(\"span\",{className:\"material-icons\"},\"credit_card\")),/*#__PURE__*/React.createElement(\"div\",{className:\"md-step-title\"},\"Thanh to\\xE1n\"),/*#__PURE__*/React.createElement(\"div\",{className:\"md-step-bar-left\"}),/*#__PURE__*/React.createElement(\"div\",{className:\"md-step-bar-right\"}))),/*#__PURE__*/React.createElement(\"div\",{className:\"container\"},/*#__PURE__*/React.createElement(\"div\",{className:\"alert alert-warning\"},/*#__PURE__*/React.createElement(\"strong\",null,\"L\\u01B0u \\xFD !\"),\" N\\u1EBFu qu\\xFD kh\\xE1ch ch\\u1ECDn thanh to\\xE1n chuy\\u1EC3n kho\\u1EA3n, vui l\\xF2ng chuy\\u1EC3n ti\\u1EC1n v\\xE9 trong v\\xF2ng \",/*#__PURE__*/React.createElement(\"strong\",null,\"12 ti\\u1EBFng\"),\" k\\u1EC3 t\\u1EEB th\\u1EDDi gian \\u0111\\u1EB7t v\\xE9.\"),/*#__PURE__*/React.createElement(\"div\",{className:\"row\"},/*#__PURE__*/React.createElement(\"div\",{className:\"col-lg-6 col-md-6 col-sm-12 col-xs-12 col-ms-12\"},/*#__PURE__*/React.createElement(\"div\",{className:\"card\"},/*#__PURE__*/React.createElement(\"div\",{className:\"card-header card-header-rose\"},/*#__PURE__*/React.createElement(\"h4\",{className:\"card-title\"},\"Ch\\u1ECDn ph\\u01B0\\u01A1ng th\\u1EE9c thanh to\\xE1n\")),/*#__PURE__*/React.createElement(\"div\",{className:\"card-body\"},/*#__PURE__*/React.createElement(PayPalButton,{amount:pay,onSuccess:function onSuccess(details,data){_this4.postDatVe();},shippingPreference:\"NO_SHIPPING\",options:{clientId:\"AWy4VjiZvKYejBmofoCTe_u7GKfgD5h8QJfyXCUVb-EnTogDnLBb-pPLEV8wH-LLGHoWaDyTIYqHB0WS\",currency:\"USD\"}})))),/*#__PURE__*/React.createElement(\"div\",{className:\"col-lg-6 col-md-6 col-sm-12 col-xs-12 col-ms-12\"},/*#__PURE__*/React.createElement(\"div\",{className:\"card\"},/*#__PURE__*/React.createElement(\"div\",{className:\"card-header card-header-rose\"},/*#__PURE__*/React.createElement(\"h4\",{className:\"card-title\"},\"Th\\xF4ng tin \\u0111\\u1EB7t v\\xE9\")),/*#__PURE__*/React.createElement(\"div\",{className:\"card-body\"},/*#__PURE__*/React.createElement(\"div\",{className:\"panel\"},/*#__PURE__*/React.createElement(\"form\",{className:\"form-horizontal\"},/*#__PURE__*/React.createElement(\"div\",{className:\"form-group\"},/*#__PURE__*/React.createElement(\"div\",{className:\"col-md-12\"},/*#__PURE__*/React.createElement(\"table\",{className:\"table\"},/*#__PURE__*/React.createElement(\"tbody\",null,/*#__PURE__*/React.createElement(\"tr\",null,/*#__PURE__*/React.createElement(\"td\",null,\"Tuy\\u1EBFn\"),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"span\",{style:{fontWeight:\"bold\"}},this.state.tuyen))),/*#__PURE__*/React.createElement(\"tr\",null,/*#__PURE__*/React.createElement(\"td\",null,\"Ng\\xE0y \\u0111i \"),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"span\",{style:{fontWeight:\"bold\"}},inngaydi))),/*#__PURE__*/React.createElement(\"tr\",null,/*#__PURE__*/React.createElement(\"td\",null,\"Gh\\u1EBF \"),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"span\",{style:{fontWeight:\"bold\"}},this.state.ghe.map(function(item){return item+\",   \";})))),/*#__PURE__*/React.createElement(\"tr\",null,/*#__PURE__*/React.createElement(\"td\",null,\"H\\u1ECD T\\xEAn \"),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"span\",{style:{fontWeight:\"bold\"}},this.state.hoten))),/*#__PURE__*/React.createElement(\"tr\",null,/*#__PURE__*/React.createElement(\"td\",null,\"S\\u1ED1 \\u0111i\\u1EC7n tho\\u1EA1i \"),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"span\",{style:{fontWeight:\"bold\"}},this.state.sdt))),/*#__PURE__*/React.createElement(\"tr\",null,/*#__PURE__*/React.createElement(\"td\",null,\"T\\u1ED5ng ti\\u1EC1n \"),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"span\",{style:{fontWeight:\"bold\"}},this.state.tongtien.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g,\",\"),\" \",\"VN\\u0110\"))),/*#__PURE__*/React.createElement(\"tr\",null,/*#__PURE__*/React.createElement(\"td\",null,\"Thanh to\\xE1n Paypal\"),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"span\",{style:{fontWeight:\"bold\"}},pay,\" USD\")))))))))))))),/*#__PURE__*/React.createElement(\"script\",{src:\"https://www.paypal.com/sdk/js?client-id=sb\"}),/*#__PURE__*/React.createElement(\"script\",null,\"paypal.Buttons().render(\\\"body\\\");\"));}}]);return ThanhToan;}(Component);export{ThanhToan as default};","map":{"version":3,"sources":["C:/xampp/htdocs/vexedientu/Front-End/dath-react/src/components/ThanhToan.js"],"names":["React","Component","PayPalButton","Axios","retesData","swal","Redirect","ThanhToan","props","state","isGoNext","postData","axiosConfig","headers","post","then","res","console","log","title","text","icon","setState","catch","err","Storage","step1","JSON","parse","sessionStorage","getItem","step2","step3","tuyen","inputTuyen","ngaydi","ngayDi","ghedat","seatReserved","toString","ghe","tongtien","hoten","inputHoTen","sdt","inputPhone","email","inputEmail","diachi","inputAddress","idxe","idXe","idlichchay","idLichChay","idtuyen","idTuyen","tongtienUSD","doiTien","alert","money","code","encode","input","parseFloat","Number","isNaN","currency","rates","value","find","item","sell","replace","output","rounded","Math","round","toFixed","tempdate","inngaydi","concat","substr","pay","marginTop","details","data","postDatVe","clientId","fontWeight","map"],"mappings":"grBAAA,MAAOA,CAAAA,KAAP,EAAgBC,SAAhB,KAAiC,OAAjC,CACA,OAASC,YAAT,KAA6B,wBAA7B,CACA,MAAOC,CAAAA,KAAP,KAAkB,OAAlB,CACA,MAAOC,CAAAA,SAAP,KAAsB,wBAAtB,CACA,MAAOC,CAAAA,IAAP,KAAiB,YAAjB,CACA,OAASC,QAAT,KAAyB,kBAAzB,C,GAEqBC,CAAAA,S,sGACnB,mBAAYC,KAAZ,CAAmB,2CACjB,uBAAMA,KAAN,EACA,MAAKC,KAAL,CAAa,CACXC,QAAQ,CAAE,KADC,CAAb,CAFiB,aAKlB,C,mEAEW,iBACV;AACA,GAAIC,CAAAA,QAAQ,CAAG,KAAKF,KAApB,CACA,GAAIG,CAAAA,WAAW,CAAG,CAChBC,OAAO,CAAE,CACP,eAAgB,gCADT,CAEP,8BAA+B,GAFxB,CADO,CAAlB,CAOAV,KAAK,CAACW,IAAN,CAAW,iBAAX,CAA8BH,QAA9B,CAAwCC,WAAxC,EACGG,IADH,CACQ,SAACC,GAAD,CAAS,CACbC,OAAO,CAACC,GAAR,CAAY,qBAAZ,CAAmCF,GAAnC,EACAX,IAAI,CAAC,CACHc,KAAK,CAAE,YADJ,CAEHC,IAAI,CAAE,oCAFH,CAGHC,IAAI,CAAE,SAHH,CAAD,CAAJ,CAIGN,IAJH,CAIQ,UAAM,CACZ,MAAI,CAACO,QAAL,CAAc,CAAEZ,QAAQ,CAAE,IAAZ,CAAd,EACD,CAND,EAOD,CAVH,EAWGa,KAXH,CAWS,SAACC,GAAD,CAAS,CACdP,OAAO,CAACC,GAAR,CAAY,eAAZ,CAA6BM,GAA7B,EACD,CAbH,EAcD,C,mCAIM;0CACqB,iBAC1B,GAAI,MAAOC,CAAAA,OAAP,GAAmB,WAAvB,CAAoC,CAClC;AACA,KAAKC,KAAL,CAAaC,IAAI,CAACC,KAAL,CAAWC,cAAc,CAACC,OAAf,CAAuB,WAAvB,CAAX,CAAb,CACA,KAAKC,KAAL,CAAaJ,IAAI,CAACC,KAAL,CAAWC,cAAc,CAACC,OAAf,CAAuB,SAAvB,CAAX,CAAb,CACA,KAAKE,KAAL,CAAaL,IAAI,CAACC,KAAL,CAAWC,cAAc,CAACC,OAAf,CAAuB,mBAAvB,CAAX,CAAb,CACA;AACA;AACA;AACA,KAAKR,QAAL,CACE,CACEW,KAAK,CAAE,KAAKP,KAAL,CAAWQ,UADpB,CAEEC,MAAM,CAAE,KAAKT,KAAL,CAAWU,MAFrB,CAGE;AACAC,MAAM,CAAE,KAAKN,KAAL,CAAWO,YAAX,CAAwBC,QAAxB,EAJV,CAKE;AACAC,GAAG,CAAE,KAAKT,KAAL,CAAWO,YANlB,CAOEG,QAAQ,CAAE,KAAKV,KAAL,CAAWU,QAPvB,CAQEC,KAAK,CAAE,KAAKV,KAAL,CAAWW,UARpB,CASEC,GAAG,CAAE,KAAKZ,KAAL,CAAWa,UATlB,CAUEC,KAAK,CAAE,KAAKd,KAAL,CAAWe,UAVpB,CAWEC,MAAM,CAAE,KAAKhB,KAAL,CAAWiB,YAXrB,CAYEC,IAAI,CAAE,KAAKnB,KAAL,CAAWoB,IAZnB,CAaEC,UAAU,CAAE,KAAKrB,KAAL,CAAWsB,UAbzB,CAcEC,OAAO,CAAE,KAAK5B,KAAL,CAAW6B,OAdtB,CAeEC,WAAW,CAAE,KAAKC,OAAL,CAAa,KAAK1B,KAAL,CAAWU,QAAxB,CAAkC,KAAlC,CAAyC,KAAzC,CAff,CADF,CAkBE,UAAM,CACJ,MAAOxB,CAAAA,OAAO,CAACC,GAAR,CAAY,MAAI,CAACT,KAAjB,CAAP,CACD,CApBH,EAsBD,CA9BD,IA8BO,CACLiD,KAAK,CAAC,6BAAD,CAAL,CACD,CACF,CAED;wCACQC,K,CAAOC,I,CAAqB,IAAfC,CAAAA,MAAe,2DAAN,IAAM,CAClC,GAAMC,CAAAA,KAAK,CAAGC,UAAU,CAACJ,KAAD,CAAxB,CACA,GAAIK,MAAM,CAACC,KAAP,CAAaH,KAAb,CAAJ,CAAyB,CACvB,MAAO,EAAP,CACD,CACD,GAAMI,CAAAA,QAAQ,CAAG9D,SAAS,CAAC+D,KAAV,CAAgB,CAAhB,EAAmBC,KAAnB,CAAyBC,IAAzB,CACf,SAACC,IAAD,QAAUA,CAAAA,IAAI,CAACV,IAAL,GAAcA,IAAxB,EADe,CAAjB,CAGA,GAAI,CAACM,QAAL,CAAe,CACb,MAAO,EAAP,CACD,CACD,GAAMK,CAAAA,IAAI,CAAGR,UAAU,CAACG,QAAQ,CAACK,IAAT,CAAcC,OAAd,CAAsB,GAAtB,CAA2B,EAA3B,CAAD,CAAvB,CACA,GAAMC,CAAAA,MAAM,CAAGZ,MAAM,CAAGC,KAAK,CAAGS,IAAX,CAAkBT,KAAK,CAAGS,IAA/C,CACA,GAAMG,CAAAA,OAAO,CAAG,CAACC,IAAI,CAACC,KAAL,CAAWH,MAAM,CAAG,IAApB,EAA4B,IAA7B,EAAmCI,OAAnC,CAA2C,CAA3C,CAAhB,CACA,MAAOH,CAAAA,OAAO,CAACnC,QAAR,EAAP,CACD,C,uCAEQ,iBACP,GAAIJ,CAAAA,MAAM,CAAG,KAAK1B,KAAL,CAAW0B,MAAxB,CACA,GAAI2C,CAAAA,QAAQ,CAAG,EAAf,CACA,GAAIC,CAAAA,QAAQ,CAAGD,QAAQ,CAACE,MAAT,CACb7C,MAAM,CAAC8C,MAAP,CAAc,CAAd,CAAiB,CAAjB,CADa,CAEb,GAFa,CAGb9C,MAAM,CAAC8C,MAAP,CAAc,CAAd,CAAiB,CAAjB,CAHa,CAIb,GAJa,CAKb9C,MAAM,CAAC8C,MAAP,CAAc,CAAd,CAAiB,CAAjB,CALa,CAMb,GANa,CAOb9C,MAAM,CAAC8C,MAAP,CAAc,CAAd,CAAiB,CAAjB,CAPa,CAQb,GARa,CASb9C,MAAM,CAAC8C,MAAP,CAAc,CAAd,CAAiB,CAAjB,CATa,CAAf,CAWA,GAAIC,CAAAA,GAAG,CAAG,KAAKzE,KAAL,CAAW+C,WAArB,CACA,GAAI,KAAK/C,KAAL,CAAWC,QAAX,GAAwB,IAA5B,CAAkC,CAChC,mBAAO,oBAAC,QAAD,EAAU,EAAE,CAAC,GAAb,EAAP,CACD,CAED,mBACE,+BAAS,SAAS,CAAC,SAAnB,CAA6B,KAAK,CAAE,CAAEyE,SAAS,CAAE,OAAb,CAApC,eACE,2BAAK,SAAS,CAAC,uBAAf,eACE,2BAAK,SAAS,CAAC,gBAAf,eACE,2BAAK,SAAS,CAAC,gBAAf,eACE,4BAAM,SAAS,CAAC,gBAAhB,mBADF,CADF,cAIE,2BAAK,SAAS,CAAC,eAAf,yBAJF,cAKE,2BAAK,SAAS,CAAC,kBAAf,EALF,cAME,2BAAK,SAAS,CAAC,mBAAf,EANF,CADF,cASE,2BAAK,SAAS,CAAC,gBAAf,eACE,2BAAK,SAAS,CAAC,gBAAf,eACE,4BAAM,SAAS,CAAC,gBAAhB,eADF,CADF,cAIE,2BAAK,SAAS,CAAC,eAAf,uBAJF,cAKE,2BAAK,SAAS,CAAC,kBAAf,EALF,cAME,2BAAK,SAAS,CAAC,mBAAf,EANF,CATF,cAiBE,2BAAK,SAAS,CAAC,gBAAf,eACE,2BAAK,SAAS,CAAC,gBAAf,eACE,4BAAM,SAAS,CAAC,gBAAhB,SADF,CADF,cAIE,2BAAK,SAAS,CAAC,eAAf,gCAJF,cAKE,2BAAK,SAAS,CAAC,kBAAf,EALF,cAME,2BAAK,SAAS,CAAC,mBAAf,EANF,CAjBF,cAyBE,2BAAK,SAAS,CAAC,gBAAf,eACE,2BAAK,SAAS,CAAC,gBAAf,eACE,4BAAM,SAAS,CAAC,gBAAhB,gBADF,CADF,cAIE,2BAAK,SAAS,CAAC,eAAf,kBAJF,cAKE,2BAAK,SAAS,CAAC,kBAAf,EALF,cAME,2BAAK,SAAS,CAAC,mBAAf,EANF,CAzBF,CADF,cAmCE,2BAAK,SAAS,CAAC,WAAf,eACE,2BAAK,SAAS,CAAC,qBAAf,eACE,oDADF,iJAEqC,kDAFrC,wDADF,cAME,2BAAK,SAAS,CAAC,KAAf,eACE,2BAAK,SAAS,CAAC,iDAAf,eACE,2BAAK,SAAS,CAAC,MAAf,eACE,2BAAK,SAAS,CAAC,8BAAf,eACE,0BAAI,SAAS,CAAC,YAAd,uDADF,CADF,cAIE,2BAAK,SAAS,CAAC,WAAf,eACE,oBAAC,YAAD,EACE,MAAM,CAAED,GADV,CAEE,SAAS,CAAE,mBAACE,OAAD,CAAUC,IAAV,CAAmB,CAC5B,MAAI,CAACC,SAAL,GACD,CAJH,CAKE,kBAAkB,CAAC,aALrB,CAME,OAAO,CAAE,CACPC,QAAQ,CACN,kFAFK,CAGPrB,QAAQ,CAAE,KAHH,CANX,EADF,CAJF,CADF,CADF,cAsBE,2BAAK,SAAS,CAAC,iDAAf,eACE,2BAAK,SAAS,CAAC,MAAf,eACE,2BAAK,SAAS,CAAC,8BAAf,eACE,0BAAI,SAAS,CAAC,YAAd,qCADF,CADF,cAIE,2BAAK,SAAS,CAAC,WAAf,eACE,2BAAK,SAAS,CAAC,OAAf,eACE,4BAAM,SAAS,CAAC,iBAAhB,eACE,2BAAK,SAAS,CAAC,YAAf,eACE,2BAAK,SAAS,CAAC,WAAf,eACE,6BAAO,SAAS,CAAC,OAAjB,eACE,8CACE,2CACE,2CADF,cAEE,2CACE,4BAAM,KAAK,CAAE,CAAEsB,UAAU,CAAE,MAAd,CAAb,EACG,KAAK/E,KAAL,CAAWwB,KADd,CADF,CAFF,CADF,cASE,2CACE,iDADF,cAEE,2CACE,4BAAM,KAAK,CAAE,CAAEuD,UAAU,CAAE,MAAd,CAAb,EACGT,QADH,CADF,CAFF,CATF,cAiBE,2CACE,0CADF,cAEE,2CACE,4BAAM,KAAK,CAAE,CAAES,UAAU,CAAE,MAAd,CAAb,EACG,KAAK/E,KAAL,CAAW+B,GAAX,CAAeiD,GAAf,CAAmB,SAACnB,IAAD,CAAU,CAC5B,MAAOA,CAAAA,IAAI,CAAG,MAAd,CACD,CAFA,CADH,CADF,CAFF,CAjBF,cA2BE,2CACE,gDADF,cAEE,2CACE,4BAAM,KAAK,CAAE,CAAEkB,UAAU,CAAE,MAAd,CAAb,EACG,KAAK/E,KAAL,CAAWiC,KADd,CADF,CAFF,CA3BF,cAmCE,2CACE,mEADF,cAEE,2CACE,4BAAM,KAAK,CAAE,CAAE8C,UAAU,CAAE,MAAd,CAAb,EACG,KAAK/E,KAAL,CAAWmC,GADd,CADF,CAFF,CAnCF,cA2CE,2CACE,qDADF,cAEE,2CACE,4BAAM,KAAK,CAAE,CAAE4C,UAAU,CAAE,MAAd,CAAb,EACG,KAAK/E,KAAL,CAAWgC,QAAX,CACEF,QADF,GAEEiC,OAFF,CAGG,uBAHH,CAIG,GAJH,CADH,CAMO,GANP,YADF,CAFF,CA3CF,cAyDE,2CACE,qDADF,cAEE,2CACE,4BAAM,KAAK,CAAE,CAAEgB,UAAU,CAAE,MAAd,CAAb,EACGN,GADH,QADF,CAFF,CAzDF,CADF,CADF,CADF,CADF,CADF,CADF,CAJF,CADF,CAtBF,CANF,CAnCF,cA6JE,8BAAQ,GAAG,CAAC,4CAAZ,EA7JF,cA8JE,uEA9JF,CADF,CAkKD,C,uBAhRoCjF,S,SAAlBM,S","sourcesContent":["import React, { Component } from \"react\";\r\nimport { PayPalButton } from \"react-paypal-button-v2\";\r\nimport Axios from \"axios\";\r\nimport retesData from \"../data/ratesData.json\";\r\nimport swal from \"sweetalert\";\r\nimport { Redirect } from \"react-router-dom\";\r\n\r\nexport default class ThanhToan extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      isGoNext: false,\r\n    };\r\n  }\r\n\r\n  postDatVe() {\r\n    // dữ liệu đẩy xuống backend xử lý\r\n    var postData = this.state;\r\n    let axiosConfig = {\r\n      headers: {\r\n        \"Content-Type\": \"application/json;charset=UTF-8\",\r\n        \"Access-Control-Allow-Origin\": \"*\",\r\n      },\r\n    };\r\n\r\n    Axios.post(\"/api/bookticket\", postData, axiosConfig)\r\n      .then((res) => {\r\n        console.log(\"RESPONSE RECEIVED: \", res);\r\n        swal({\r\n          title: \"Tuyệt vời!\",\r\n          text: \"Vé của bạn đã được đặt thành công!\",\r\n          icon: \"success\",\r\n        }).then(() => {\r\n          this.setState({ isGoNext: true });\r\n        });\r\n      })\r\n      .catch((err) => {\r\n        console.log(\"AXIOS ERROR: \", err);\r\n      });\r\n  }\r\n\r\n  step1; // dữ liệu bước chọn tuyến\r\n  step2; // dữ liệu bước chọn ghế\r\n  step3; // dữ liệu bước điền thông tin khách hàng\r\n  UNSAFE_componentWillMount() {\r\n    if (typeof Storage !== \"undefined\") {\r\n      // get sessionStorage\r\n      this.step1 = JSON.parse(sessionStorage.getItem(\"chonTuyen\"));\r\n      this.step2 = JSON.parse(sessionStorage.getItem(\"chonghe\"));\r\n      this.step3 = JSON.parse(sessionStorage.getItem(\"thongtinkhachhang\"));\r\n      // chuyển tiền Việt nam qua tiền đô la để thanh toán paypal\r\n      //console.log(this.doiTien(this.step2.tongtien, \"USD\", false));\r\n      //console.log(typeof this.doiTien(this.step2.tongtien, \"USD\", false));\r\n      this.setState(\r\n        {\r\n          tuyen: this.step1.inputTuyen,\r\n          ngaydi: this.step1.ngayDi,\r\n          // ép mảng ghế về chuỗi cho phù hợp với cơ sở dữ liệu\r\n          ghedat: this.step2.seatReserved.toString(),\r\n          // các ghế đã đặt ở dạng mảng để có thể in ra giao diện\r\n          ghe: this.step2.seatReserved,\r\n          tongtien: this.step2.tongtien,\r\n          hoten: this.step3.inputHoTen,\r\n          sdt: this.step3.inputPhone,\r\n          email: this.step3.inputEmail,\r\n          diachi: this.step3.inputAddress,\r\n          idxe: this.step2.idXe,\r\n          idlichchay: this.step2.idLichChay,\r\n          idtuyen: this.step1.idTuyen,\r\n          tongtienUSD: this.doiTien(this.step2.tongtien, \"USD\", false),\r\n        },\r\n        () => {\r\n          return console.log(this.state);\r\n        }\r\n      );\r\n    } else {\r\n      alert(\"Vui lòng quay lại trang chủ\");\r\n    }\r\n  }\r\n\r\n  // ham chuyen đổi tỷ giá ngoại tệ\r\n  doiTien(money, code, encode = true) {\r\n    const input = parseFloat(money);\r\n    if (Number.isNaN(input)) {\r\n      return \"\";\r\n    }\r\n    const currency = retesData.rates[0].value.find(\r\n      (item) => item.code === code\r\n    );\r\n    if (!currency) {\r\n      return \"\";\r\n    }\r\n    const sell = parseFloat(currency.sell.replace(\",\", \"\"));\r\n    const output = encode ? input * sell : input / sell;\r\n    const rounded = (Math.round(output * 1000) / 1000).toFixed(2);\r\n    return rounded.toString();\r\n  }\r\n\r\n  render() {\r\n    var ngaydi = this.state.ngaydi;\r\n    var tempdate = \"\";\r\n    var inngaydi = tempdate.concat(\r\n      ngaydi.substr(8, 2),\r\n      \" \",\r\n      ngaydi.substr(4, 1),\r\n      \" \",\r\n      ngaydi.substr(5, 2),\r\n      \" \",\r\n      ngaydi.substr(4, 1),\r\n      \" \",\r\n      ngaydi.substr(0, 4)\r\n    );\r\n    var pay = this.state.tongtienUSD;\r\n    if (this.state.isGoNext === true) {\r\n      return <Redirect to=\"/\" />;\r\n    }\r\n\r\n    return (\r\n      <section className=\"payment\" style={{ marginTop: \"100px\" }}>\r\n        <div className=\"md-stepper-horizontal\">\r\n          <div className=\"md-step active\">\r\n            <div className=\"md-step-circle\">\r\n              <span className=\"material-icons\">directions_bus</span>\r\n            </div>\r\n            <div className=\"md-step-title\">Chọn tuyến</div>\r\n            <div className=\"md-step-bar-left\" />\r\n            <div className=\"md-step-bar-right\" />\r\n          </div>\r\n          <div className=\"md-step active\">\r\n            <div className=\"md-step-circle\">\r\n              <span className=\"material-icons\">event_seat</span>\r\n            </div>\r\n            <div className=\"md-step-title\">Chọn ghế</div>\r\n            <div className=\"md-step-bar-left\" />\r\n            <div className=\"md-step-bar-right\" />\r\n          </div>\r\n          <div className=\"md-step active\">\r\n            <div className=\"md-step-circle\">\r\n              <span className=\"material-icons\">edit</span>\r\n            </div>\r\n            <div className=\"md-step-title\">Điền thông tin</div>\r\n            <div className=\"md-step-bar-left\" />\r\n            <div className=\"md-step-bar-right\" />\r\n          </div>\r\n          <div className=\"md-step active\">\r\n            <div className=\"md-step-circle\">\r\n              <span className=\"material-icons\">credit_card</span>\r\n            </div>\r\n            <div className=\"md-step-title\">Thanh toán</div>\r\n            <div className=\"md-step-bar-left\" />\r\n            <div className=\"md-step-bar-right\" />\r\n          </div>\r\n        </div>\r\n        <div className=\"container\">\r\n          <div className=\"alert alert-warning\">\r\n            <strong>Lưu ý !</strong> Nếu quý khách chọn thanh toán chuyển khoản,\r\n            vui lòng chuyển tiền vé trong vòng <strong>12 tiếng</strong> kể từ\r\n            thời gian đặt vé.\r\n          </div>\r\n          <div className=\"row\">\r\n            <div className=\"col-lg-6 col-md-6 col-sm-12 col-xs-12 col-ms-12\">\r\n              <div className=\"card\">\r\n                <div className=\"card-header card-header-rose\">\r\n                  <h4 className=\"card-title\">Chọn phương thức thanh toán</h4>\r\n                </div>\r\n                <div className=\"card-body\">\r\n                  <PayPalButton\r\n                    amount={pay}\r\n                    onSuccess={(details, data) => {\r\n                      this.postDatVe();\r\n                    }}\r\n                    shippingPreference=\"NO_SHIPPING\"\r\n                    options={{\r\n                      clientId:\r\n                        \"AWy4VjiZvKYejBmofoCTe_u7GKfgD5h8QJfyXCUVb-EnTogDnLBb-pPLEV8wH-LLGHoWaDyTIYqHB0WS\",\r\n                      currency: \"USD\",\r\n                    }}\r\n                  />\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div className=\"col-lg-6 col-md-6 col-sm-12 col-xs-12 col-ms-12\">\r\n              <div className=\"card\">\r\n                <div className=\"card-header card-header-rose\">\r\n                  <h4 className=\"card-title\">Thông tin đặt vé</h4>\r\n                </div>\r\n                <div className=\"card-body\">\r\n                  <div className=\"panel\">\r\n                    <form className=\"form-horizontal\">\r\n                      <div className=\"form-group\">\r\n                        <div className=\"col-md-12\">\r\n                          <table className=\"table\">\r\n                            <tbody>\r\n                              <tr>\r\n                                <td>Tuyến</td>\r\n                                <td>\r\n                                  <span style={{ fontWeight: \"bold\" }}>\r\n                                    {this.state.tuyen}\r\n                                  </span>\r\n                                </td>\r\n                              </tr>\r\n                              <tr>\r\n                                <td>Ngày đi </td>\r\n                                <td>\r\n                                  <span style={{ fontWeight: \"bold\" }}>\r\n                                    {inngaydi}\r\n                                  </span>\r\n                                </td>\r\n                              </tr>\r\n                              <tr>\r\n                                <td>Ghế </td>\r\n                                <td>\r\n                                  <span style={{ fontWeight: \"bold\" }}>\r\n                                    {this.state.ghe.map((item) => {\r\n                                      return item + \",   \";\r\n                                    })}\r\n                                  </span>\r\n                                </td>\r\n                              </tr>\r\n                              <tr>\r\n                                <td>Họ Tên </td>\r\n                                <td>\r\n                                  <span style={{ fontWeight: \"bold\" }}>\r\n                                    {this.state.hoten}\r\n                                  </span>\r\n                                </td>\r\n                              </tr>\r\n                              <tr>\r\n                                <td>Số điện thoại </td>\r\n                                <td>\r\n                                  <span style={{ fontWeight: \"bold\" }}>\r\n                                    {this.state.sdt}\r\n                                  </span>\r\n                                </td>\r\n                              </tr>\r\n                              <tr>\r\n                                <td>Tổng tiền </td>\r\n                                <td>\r\n                                  <span style={{ fontWeight: \"bold\" }}>\r\n                                    {this.state.tongtien\r\n                                      .toString()\r\n                                      .replace(\r\n                                        /\\B(?=(\\d{3})+(?!\\d))/g,\r\n                                        \",\"\r\n                                      )}{\" \"}\r\n                                    VNĐ\r\n                                  </span>\r\n                                </td>\r\n                              </tr>\r\n                              <tr>\r\n                                <td>Thanh toán Paypal</td>\r\n                                <td>\r\n                                  <span style={{ fontWeight: \"bold\" }}>\r\n                                    {pay} USD\r\n                                  </span>\r\n                                </td>\r\n                              </tr>\r\n                            </tbody>\r\n                          </table>\r\n                        </div>\r\n                      </div>\r\n                      {/* <div className=\"form-group\">\r\n                        <div className=\"col-lg-12 col-md-12 col-sm-2 col-xs-12 col-ms-12\">\r\n                          <button className=\"btn btn-primary btn-block\">\r\n                            Thanh Toán\r\n                          </button>\r\n                        </div>\r\n                      </div> */}\r\n                    </form>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <script src=\"https://www.paypal.com/sdk/js?client-id=sb\"></script>\r\n        <script>paypal.Buttons().render(\"body\");</script>\r\n      </section>\r\n    );\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}